#!/bin/bash

echo "ğŸš€ [1/4] ìƒˆë¡œìš´ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ êµ½ìŠµë‹ˆë‹¤..."
# ë¹Œë“œí•˜ë‹¤ê°€ ì—ëŸ¬ ë‚˜ë©´ ì¦‰ì‹œ ì¤‘ë‹¨ (ì•ˆì „ì¥ì¹˜)
docker build -t class-server . || { echo "âŒ ë¹Œë“œ ì‹¤íŒ¨! ë°°í¬ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤."; exit 1; }

echo "ğŸ›‘ [2/4] ê¸°ì¡´ ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•©ë‹ˆë‹¤..."
# ê¸°ì¡´ì— ì¼œì ¸ ìˆëŠ” 'my-class-server'ë¥¼ ê°•ì œë¡œ ë„ê³  ì‚­ì œí•©ë‹ˆë‹¤.
# 2>/dev/null || true ë¶€ë¶„ì€ "ì‚­ì œí•  ê²Œ ì—†ì–´ë„ ì—ëŸ¬ ë‚´ì§€ ë§ê³  ë„˜ì–´ê°€ë¼"ëŠ” ëœ»ì…ë‹ˆë‹¤.
docker rm -f my-class-server 2>/dev/null || true

echo "ğŸƒ [3/4] ìƒˆ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."
# ì•„ê¹Œ ì„±ê³µí–ˆë˜ ê·¸ ê¸´ ëª…ë ¹ì–´ì…ë‹ˆë‹¤.
docker run -d \
  --name my-class-server \
  --restart unless-stopped \
  -p 3000:3000 \
  --env-file .env \
  -v $(pwd)/tokens.json:/usr/src/app/tokens.json \
  class-server

echo "ğŸ§¹ [4/4] ë¶ˆí•„ìš”í•œ ì´ë¯¸ì§€ ì°Œêº¼ê¸° ì²­ì†Œ..."
# ë¹Œë“œí•  ë•Œë§ˆë‹¤ ìŒ“ì´ëŠ” <none> ì´ë¯¸ì§€ë“¤ì„ ì§€ì›Œì¤ë‹ˆë‹¤. (ìš©ëŸ‰ ì ˆì•½)
docker image prune -f

echo "âœ… ë°°í¬ ì™„ë£Œ! ì‹¤ì‹œê°„ ë¡œê·¸ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤. (ë‚˜ê°€ë ¤ë©´ Ctrl+C)"
echo "-----------------------------------------------------"
# ë°”ë¡œ ë¡œê·¸ë¥¼ ë³´ì—¬ì¤˜ì„œ ì„œë²„ê°€ ì˜ ë–´ëŠ”ì§€ í™•ì¸ì‹œì¼œ ì¤ë‹ˆë‹¤.
docker logs -f my-class-server